function Container(){this.id="",this.className="",this.htmlCode=""}function Carousel(){Container.call(this,"carousel"),this.effects=!0,this.widthCarousel=0,this.currency="",this.leftString=0,this.productsSlide=0,this.productsFirst=1,this.countProducts=0,this.productsItems=[],this.effectsString=function(){if(""!=this.effects){var t={"-webkit-transition":this.effects,"-o-transition":this.effects,transition:this.effects};$(".carousel__products-string").css(t)}},this.widthCarouselNav=function(){return $(".carousel__nav").width()},this.widthProduct=function(){return $(".carousel__products-container").width()+20},this.widthString=function(){var t=this.widthProduct()*this.countProducts;return $(".carousel__products-string").css({width:t}),t},this.loadCarouselItems(),this.render(),this.renderDots(),this.productsBasket=[],this.delBasket(),this.addBasket(),this.amountBasket(),this.totalBasket(),this.renderBasket(),this.keyDown(),this.arrows()}Container.prototype.render=function(){return this.htmlCode},Carousel.prototype=Object.create(Container.prototype),Carousel.prototype.constructor=Carousel,Carousel.prototype.arrows=function(t){"right"==t?(this.leftString-=this.widthProduct(),this.productsFirst++):"left"==t?(this.leftString+=this.widthProduct(),this.productsFirst--):isNaN(t)||(this.leftString=-(t-1)*this.productsSlide*this.widthProduct(),this.productsFirst=t*this.productsSlide),this.leftString>0&&(this.leftString=0,this.productsFirst=1),this.leftString<this.widthProduct()*this.productsSlide-this.widthString()&&(this.leftString=this.widthProduct()*this.productsSlide-this.widthString(),this.productsFirst=this.countProducts-this.productsSlide+1),$(".carousel__products-string").css({left:this.leftString}),this.renderDots(".carousel__dots-items")},Carousel.prototype.render=function(t){var s=this;$(".carousel").css({width:this.widthCarousel}),this.effectsString(),this.widthCarouselNav(),this.widthProduct(),this.widthString(),$(t).empty();for(var e in this.productsItems){var a="carousel__products-container_"+e,r=$("<div />",{class:"carousel__products-container",id:a});r.appendTo(t),$("#"+a).draggable({revert:"invalid",helper:function(){return $(this).clone()},appendTo:"body",scroll:!1,start:function(){$(this).css({opacity:0})},stop:function(){$(this).css({opacity:100})}});var o=$("<div />",{class:"carousel__products-items"});o.appendTo(r);var i="carousel__products-items-images_"+e;$("<div />",{class:"carousel__products-items-images",id:i,style:"background-image: url("+this.productsItems[e].image+")"}).appendTo(o),$("<div />",{class:"carousel__products-items-titles",text:this.productsItems[e].title}).appendTo(o),$("<div />",{class:"carousel__products-items-descriptions",text:this.productsItems[e].description}).appendTo(o),$("<div />",{class:"carousel__products-items-prices",text:this.productsItems[e].price+this.currency}).appendTo(o);var l="carousel__products-items-basket_"+e;$("<div />",{class:"carousel__products-items-basket",id:l,text:"В корзину"}).appendTo(o),$("#"+l).on("click",function(){s.addBasket(s,this.id),s.renderBasket(".basket__table")})}},Carousel.prototype.renderDots=function(t){var s=this;$(t).empty();for(var e=1;e<=this.countProducts/this.productsSlide;++e){var a="";Math.ceil(this.productsFirst/this.productsSlide)==e&&(a=" carousel__dots-items-links-rounds_active");var r=$("<span />",{class:"carousel__dots-items-links"});r.appendTo(t);var o="carousel__dots-items-links-rounds_"+e;$("<span />",{id:o,class:"carousel__dots-items-links-rounds"+a}).appendTo(r),$("#"+o).on("click",function(){s.arrows($(this).attr("id").split("_")[3])})}},Carousel.prototype.renderBasket=function(t){var s=this;if($(t).empty(),this.productsBasket.length>0){$(t).css({display:"table"}),$(".basket__button").css({display:"block"});var e=$("<div />",{class:"basket__table-row basket__table-row_header"});e.appendTo(t);var a="basket__table-cell basket__table-cell_numbers",r=$("<span />",{class:a,text:"№"});r.appendTo(e);var o="basket__table-cell basket__table-cell_titles",i=$("<span />",{class:o,text:"Наименование"});i.appendTo(e);var l="basket__table-cell basket__table-cell_photos",c=$("<span />",{class:l,text:"Фото"});c.appendTo(e);var n="basket__table-cell basket__table-cell_descriptions",d=$("<span />",{class:n,text:"Описание"});d.appendTo(e);var u="basket__table-cell basket__table-cell_prices",p=$("<span />",{class:u,text:"Цена"});p.appendTo(e);var _="basket__table-cell basket__table-cell_amount",h=$("<span />",{class:_,text:"Кол-во"});h.appendTo(e);var b="basket__table-cell basket__table-cell_count",k=$("<span />",{class:b,text:"Сумма"});k.appendTo(e);var f="basket__table-cell basket__table-cell_del",m=$("<span />",{class:f,text:"Операция"});m.appendTo(e);for(var v in this.productsBasket){var g=this.productsBasket[v].number,y=$("<div />",{class:"basket__table-row basket__table-row_products"});y.appendTo(t),a="basket__table-cell basket__table-cell_numbers",(r=$("<span />",{class:a})).appendTo(y),o="basket__table-cell basket__table-cell_titles",(i=$("<span />",{class:o,text:this.productsItems[g].title})).appendTo(y),l="basket__table-cell basket__table-cell_photos",(c=$("<span />",{class:l,style:"background-image: url("+this.productsItems[g].image+")"})).appendTo(y),n="basket__table-cell basket__table-cell_descriptions",(d=$("<span />",{class:n,text:this.productsItems[g].description})).appendTo(y);var w=this.productsItems[g].price;u="basket__table-cell basket__table-cell_prices",(p=$("<span />",{class:u,text:w+this.currency})).appendTo(y),_="basket__table-cell basket__table-cell_amount",(h=$("<span />",{class:_,text:""})).appendTo(y);var B=this.productsBasket[v].count,T="basket__table-cell_amount-input_"+g;$("<input />",{id:T,class:"basket__table-cell_amount-input",maxlength:2,type:"number",min:1,max:10,value:B}).appendTo(h),$("#"+T).on("click keyup input",function(){this.value.length>this.maxLength?this.value=this.value.slice(0,this.maxLength):s.amountBasket(this.id)});var C="basket__table-cell_count_"+g;b="basket__table-cell basket__table-cell_count",(k=$("<span />",{id:C,class:b,text:w*B+this.currency})).appendTo(y),f="basket__table-cell basket__table-cell_del",(m=$("<span />",{class:f})).appendTo(y);var x="basket__table-cell_del-button_"+g;$("<span />",{class:"basket__table-cell_del-button",id:x,text:"Удалить"}).appendTo(m),$("#"+x).on("click",function(){s.delBasket(this.id)})}var S=$("<div />",{class:"basket__table-row basket__table-row_sum"});S.appendTo(t);for(var I=1;I<=7;I++){$("<span />",{class:"basket__table-cell",html:"&nbsp;"}).appendTo(S)}$("<span />",{class:"basket__table-cell basket__table-cell_total",text:this.totalBasket()}).appendTo(S)}else $(t).css({display:"none"}),$(".basket__button").css({display:"none"})},Carousel.prototype.totalBasket=function(){var t=0;for(var s in this.productsBasket){var e=this.productsBasket[s].number;t+=this.productsItems[e].price*this.productsBasket[s].count}return"ИТОГО: "+t+this.currency},Carousel.prototype.amountBasket=function(t){if("string"==typeof t){var s=$("#"+t).val(),e=t.split("_")[4],a=this.productsItems[e].price*s+this.currency;for(var r in this.productsBasket)this.productsBasket[r].number==e&&(this.productsBasket[r].count=s);$("#basket__table-cell_count_"+e).text(a),$(".basket__table-cell_total").text(this.totalBasket())}},Carousel.prototype.delBasket=function(t){if("string"==typeof t){var s=t.split("_")[4];for(var e in this.productsBasket)this.productsBasket[e].number==s&&this.productsBasket.splice(e,1);$("#"+t).parent().parent().remove(),this.renderBasket(".basket__table")}},Carousel.prototype.loadCarouselItems=function(){$.get({url:"./json/carousel.json",dataType:"json",error:function(){console.log("JSON file settings load: Error!")},success:function(t){console.log("JSON file settings load: Ок!"),this.effects=t.effects,this.widthCarousel=t.widthCarousel,this.productsSlide=t.productsSlide,this.currency=t.currency,this.countProducts=t.products.length;for(var s in t.products)this.productsItems.push(t.products[s]);this.render(".carousel__products-string"),this.renderDots(".carousel__dots-items"),this.renderBasket(".basket__table"),$(".carousel").css({opacity:100})},context:this})},Carousel.prototype.keyDown=function(){var t=this,s={37:"left",39:"right"};$("body").on("keydown",function(e){e.keyCode in s&&t.arrows(s[e.keyCode])})},Carousel.prototype.addBasket=function(t,s){if("string"==typeof s){var e=$("#"+s).attr("id").split("_")[3],a=!1;for(var r in t.productsBasket)t.productsBasket[r].number==e&&(a=!0,t.productsBasket[r].count++);a||t.productsBasket.push({number:parseInt(e),count:1})}},$(document).ready(function(){var t=new Carousel;$(".carousel__nav-arrows-links_left").on("click",function(){t.arrows("left")}),$(".carousel__nav-arrows-links_right").on("click",function(){t.arrows("right")}),$(".basket__button").on("click",function(){$("."+this.className).effect("bounce",{times:3},"slow")}),$(".basket").droppable({drop:function(s,e){$(".basket").css("border","solid 1px white"),t.addBasket(t,e.draggable[0].id),t.renderBasket(".basket__table")},over:function(t,s){$(".basket").css("border","solid 1px #007DC7")},out:function(t,s){$(".basket").css("border","solid 1px white")}})});